(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{207:function(e,t,a){e.exports=a(339)},248:function(e,t){},250:function(e,t){},339:function(t,a,n){"use strict";n.r(a);n(338);var r=n(346),o=n(7),s=n.n(o),i=n(54),l=n.n(i),c=n(19),u=n.n(c),d=n(205),p=n(0),h=n.n(p),f=n(6),y=n(39),m=n(3),g=n(29),v=n(36),b=n(111),w=n(110),F=n(345),O={backgroundGradientFrom:"#FFFFFF",backgroundGradientTo:"#FFFFFF",decimalPlaces:0,color:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return"rgba(80, 80, 80, "+e+")"},strokeWidth:0,barPercentage:.8,useShadowColorFromDataset:!1},E=(n(2),n(143)),S=n(199),C=n.n(S),P={SystemLog:{display:"Last Log"},resetReason:{display:"Reset Reason"},espFwRevision:{display:"ESP Firmware Version"},TiFwRevision:{display:"MSP Firmware Version"},wifiRxSignaldB:{display:"Wifi Signal"},heartBeat:{display:"Last Heartbeat"},dropboxId:{display:"Dropbox Instance"},serviceMode:{display:"Service Mode Flag"},timeZone:{display:"Timezone"},maxTmrBackoff:{display:"Max TMR Backoff"}},k={siteName:{display:"Site Name"},installLocation:{display:"Install Location"},waterSource:{display:"Municipal"},siteNotes:{display:"Site Notes"},pipeType:{display:"Pipe Type"}},j={transmitFrequency:{display:"Frequency"},numOfExcitationPulses:{display:"Pulse Count"},gainControl:{display:"Gain"},envelopeCrossingThreshold:{display:"Envelope Threshold"},startADCsamplingCount:{display:"Start ADC Count"},sampleSize:{display:"Window Size"},"3V3TxVoltage":{display:"3V3 TX Voltage"},attenEnabled:{display:"Attenuation"},pipeType:{display:"Pipe Type"}},T=n(8),D=n.n(T),R=n(11),x=n.n(R),M={},A=function(){function t(e){D()(this,t),this.id=e,this.status=null,this.events=[],this.system={},this.metadata={},this.params={}}return x()(t,[{key:"updateSystemProp",value:function(e,t){null!=P[e]&&(this.system[e]=t)}},{key:"updateMetadataProp",value:function(e,t){null!=k[e]&&(this.metadata[e]=t)}},{key:"updateParamProp",value:function(e,t){null!=j[e]&&(this.params[e]=t)}},{key:"updateEventProp",value:function(t,a){var n=t.join(".");this.events.push({type:n,data:a});var r=null;try{if(null==(r=JSON.parse(a)))return void console.log("Failed to parse event msg as json: ",a,e.message)}catch(e){return void console.log("Failed to parse event msg as json: ",a,e.message)}"status"==n&&(null!=r.status?this.status=r.status:null!=r["esp version"]?this.system.espFwRevision=r["esp version"]:null!=r["TI version"]&&(this.system.TiFwRevision=r["TI version"]))}},{key:"updateFromRx",value:function(e,t){var a=e.split("/"),n=a[3];"system"==n?this.updateSystemProp(a[4],t):"metadata"==n?this.updateMetadataProp(a[4],t):"params"==n?this.updateParamProp(a[4],t):"events"==n&&this.updateEventProp(a.slice(4),t)}},{key:"toString",value:function(){var e=["----------------------------------------"];for(var t in e.push(this.id),e.push("----------------------------------------"),e.push("Status: "+this.status),e.push("----System Properties----"),this.system)e.push(t+": "+this.system[t]);for(var a in e.push("----Metadata----"),this.metadata)e.push(a+": "+this.metadata[a]);for(var n in e.push("----Sensor Parameters----"),this.params)e.push(n+": "+this.params[n]);return e.join("\n")}}],[{key:"extractDeviceString",value:function(e){var t=e.split("/");if(t.length<=3)return null;var a=t[2];return a.startsWith("AW")&&6==a.length?a:null}},{key:"getDeviceForTopic",value:function(e){var a=t.extractDeviceString(e);return a?(null!=M[a]||(M[a]=new t(a)),M[a]):null}},{key:"getDevices",value:function(){return M}}]),t}(),W=null,L=[],B=C.a.connect("wss://dizzofac:Qbz5ly_pY0MS@stellar-lifeguard.cloudmqtt.com:443");B.on("message",(function(e,t){H++%100==0&&console.log(e,t.toString());var a=A.getDeviceForTopic(e);if(null==a)return;a.updateFromRx(e,t.toString()),clearTimeout(W),W=setTimeout(z,200)})),B.on("connect",(function(e,t){console.log("connected to MQTT broker"),B.subscribe("/AWACS_ADC_vAf5hLnp6J/#",(function(e){e?(console.warn("Failed to subscribe"),alert("ERROR: Unable to reach MQTT Server: ",e)):console.debug("Subscribe successful")}))}));var H=0;function z(){console.log("Notifying!");for(var e=A.getDevices(),t=0;t<L.length;t++)L[t](e)}function I(e){L.push(e)}function N(e){for(var t=-1,a=0;a<L.length;a++)if(L[a]==e){t=a;break}t>-1&&L.splice(t,1)}function V(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function J(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?V(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):V(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var q=g.a.get("window").width,G=g.a.get("window").height,Q={labels:[],datasets:[{data:[],colors:[]}]},_=function(){return q>400?q/3:q/1.4};function U(e){var t=3;return e.data&&e.data.length||(t=2),h.a.createElement(m.a,{style:[te.chartContainer]},h.a.createElement(m.a,{style:te.chartWrap},h.a.createElement(y.a,{style:te.chartHeader},e.title),h.a.createElement(E.a,u()({key:Math.random()+"",style:{marginVertical:8,borderRadius:16},data:e.data,width:_(),height:200,chartConfig:O,yAxisInterval:10,segments:t,yLabelsOffset:e.yLabelsOffset||35,withCustomBarColorFromData:!0,flatColor:!0,fromZero:!0,withInnerLines:!0,showValuesOnTopOfBars:!0,showBarTops:!1},e))))}function Z(){var e=Object(p.useState)([]),t=l()(e,2),a=t[0],n=t[1],r=Object(p.useState)([]),o=l()(r,2),s=o[0],i=o[1],c=function(e){var t=[],a=[];for(var r in e)99!=e[r].status?t.push(r):a.push(r);n(t),i(a)};Object(p.useEffect)((function(){I(c)}),[]);var u={labels:["Connected","Disconnected"],datasets:[{data:[a.length,s.length],colors:[function(){return"#00FF00"},function(){return"red"}]}]};return h.a.createElement(U,{data:u,title:"Connection Status"})}function X(e){var t=Object(p.useState)([]),a=l()(t,2),n=a[0],r=a[1],o="",s="";"ESP"==e.processor?(o="espFwRevision",s="ESP32 Firmware"):(o="TiFwRevision",s="MSP430 Firmware");var i=function(t){var a={};for(var n in t)if(!e.connectedOnly||99!=t[n].status){var s=t[n].system[o];null==a[s=s?"v"+s:"Unknown"]?a[s]=1:a[s]+=1}var i=["#886677","#33DDBB","yellow","cyan","#CC7777","#CDCDCD","#00FF00","gray"],l=Object.keys(a).map((function(e,t){var n;return n=t>=i.length?"#"+Math.random().toString(16).slice(-6):i[t],{name:"("+e+")",count:a[e],color:n,legendFontColor:"#7F7F7F",legendFontSize:15}}));r(l)};return Object(p.useEffect)((function(){I(i)}),[]),Object(p.useEffect)((function(){return i(A.getDevices()),function(){N(i)}}),[e.connectedOnly]),h.a.createElement(m.a,{style:[te.chartContainer]},h.a.createElement(m.a,{style:[te.chartWrap]},h.a.createElement(y.a,{style:te.chartHeader},s),h.a.createElement(E.b,{accessor:"count",data:n,width:_(),height:150,chartConfig:O,backgroundColor:"#FFFFFF00",withCustomBarColorFromData:!0,flatColor:!0,absolute:!0})))}function Y(e){var t=Object(p.useState)(Q),a=l()(t,2),n=a[0],r=a[1],o=function(t){var a={"?":0};for(var n in t)if(!e.connectedOnly||99!=t[n].status){var o=t[n].system.wifiRxSignaldB;o=parseInt(o),isNaN(o)?a["?"]+=1:(o=10*Math.ceil(o/10),null==a[o]?a[o]=1:a[o]+=1)}var s=J({},Q);s.labels=Object.keys(a).sort(),s.datasets=[{data:s.labels.map((function(e){return a[e]})),colors:s.labels.map((function(e,t){return function(){return"rgb("+40*t+", "+(255-40*t)+", 0)"}}))}],r(s)};return Object(p.useEffect)((function(){I(o)}),[]),Object(p.useEffect)((function(){return o(A.getDevices()),function(){N(o)}}),[e.connectedOnly]),h.a.createElement(U,{key:"wifi",data:n,title:"Wifi Signal Level",verticalLabelRotation:q>400?void 0:30,yLabelsOffset:10,width:q>400?.7*q:q-20,chartConfig:J(J({},O),{},{barPercentage:q>400?.8:.3}),style:{marginLeft:-40,width:q>400?.7*q:q-20}})}function K(e){return q>400?h.a.createElement(m.a,{style:{flexDirection:"row"}},e.children):e.children}function $(e){return h.a.createElement(m.a,{style:{flex:1,margin:8,alignItems:"center"}},h.a.createElement(Z,null),h.a.createElement(K,null,h.a.createElement(X,{key:Math.random()+"",processor:"ESP",connectedOnly:e.connectedOnly}),h.a.createElement(X,{key:Math.random()+"",processor:"MSP",connectedOnly:e.connectedOnly})),h.a.createElement(Y,{key:Math.random()+"",connectedOnly:e.connectedOnly}))}function ee(e){return h.a.createElement(m.a,{style:te.screenHeaderWrap},h.a.createElement(m.a,{style:te.screenHeader},h.a.createElement(y.a,{style:te.screenHeaderTxt},"AWACS Dashboard"),h.a.createElement(w.a,{style:[te.button,{backgroundColor:e.connectedOnly?"#99FFAA":"#EAEAEA"}],onPress:function(){e.setConnectedFilter(!e.connectedOnly)}},h.a.createElement(F.a,{name:"md-filter",size:22,color:"green"}))))}var te=f.a.create({root:{backgroundColor:"white",flex:1},screenHeaderWrap:{height:G/10+8,minHeight:88,overflow:"hidden"},screenHeader:{height:G/10,minHeight:80,backgroundColor:"white",width:q,justifyContent:"space-between",alignItems:"flex-end",flexDirection:"row",padding:10,shadowColor:"#000",shadowOpacity:.3,shadowRadius:7,paddingRight:q>400?30:10},screenHeaderTxt:{fontSize:22,fontWeight:"bold",color:"#535353"},button:{padding:5,borderRadius:10,shadowColor:"#000",shadowOpacity:.2,shadowRadius:2,shadowOffset:{width:0,height:2}},container:{flex:1,backgroundColor:"#EFEFEF"},chartContainer:{borderRadius:20,marginHorizontal:25,marginBottom:25,shadowColor:"#000",shadowOpacity:.3,shadowRadius:7,shadowOffset:{width:0,height:3}},chartWrap:{padding:10,borderRadius:20,backgroundColor:"#FFFFFF",overflow:"hidden"},chartHeader:{fontSize:15,padding:5,marginBottom:10,fontWeight:"bold",color:"#535353"}});Object(r.a)((function(){var e=Object(p.useState)(!1),t=l()(e,2),a=t[0],n=t[1];return h.a.createElement(b.a,{style:te.root},h.a.createElement(m.a,{style:te.container},h.a.createElement(d.a,{style:"auto"}),h.a.createElement(ee,{connectedOnly:a,setConnectedFilter:function(e){return n(e)}}),h.a.createElement(v.a,null,h.a.createElement($,{connectedOnly:a}))))}))}},[[207,1,2]]]);
//# sourceMappingURL=app.6c04a38e.chunk.js.map